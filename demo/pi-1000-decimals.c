#define CINT_SCALE 400

#include "cint.c"

#include <stdlib.h>
#include <stdio.h>

void factorial(cint *n, long long int num) {
    cint_init(n, 1);
    for (int i = 2; i <= num; ++i)
        cint_nat_muli(n, i);
}

void get_pi(cint * pi, int decimals) {
    cint a, b, c, d, e, f;
    cint_init(&d, 0);
    cint_init(&e, 13591409);
    cint_init(&f, 10);
    cint_powi(&f, decimals + decimals);
    for (long long int i = 0, j = 2 + decimals / 14; i < j; ++i) {
        factorial(pi, 6 * i);
        cint_init(&a, 545140134 * i);
        cint_addi(&a, &e);
        cint_muli(pi, &a);
        cint_muli(pi, &f);
        factorial(&a, 3 * i);
        factorial(&b, i);
        cint_powi(&b, 3);
        cint_init(&c, 640320);
        cint_powi(&c, 3 * i);
        cint_muli(&a, &b);
        cint_muli(&a, &c);
        cint_divi(pi, &a);
        if (i & 1)
            cint_subi(&d, pi);
        else
            cint_addi(&d, pi);
    }
    cint_init(pi, 10005);
    cint_muli(pi, &f);
    cint_sqrti(pi);
    cint_nat_muli(pi, 426880);
    cint_muli(pi, &f);
    cint_divi(pi, &d);
}

int main(void){
    cint pi ;
    get_pi(&pi, 1000);
    char *str = cint_to_string(&pi, 10);
    printf("pi = %c.%s", *str, str + 1);
    free(str);
}

/*
Output pi = 3.1415926535897932384626433832795028841971693993751058209749445
923078164062862089986280348253421170679821480865132823066470938446095505822
317253594081284811174502841027019385211055596446229489549303819644288109756
659334461284756482337867831652712019091456485669234603486104543266482133936
072602491412737245870066063155881748815209209628292540917153643678925903600
113305305488204665213841469519415116094330572703657595919530921861173819326
117931051185480744623799627495673518857527248912279381830119491298336733624
406566430860213949463952247371907021798609437027705392171762931767523846748
184676694051320005681271452635608277857713427577896091736371787214684409012
249534301465495853710507922796892589235420199561121290219608640344181598136
297747713099605187072113499999983729780499510597317328160963185950244594553
469083026425223082533446850352619311881710100031378387528865875332083814206
171776691473035982534904287554687311595628638823537875937519577818577805321
712268066130019278766111959092164201989
*/
